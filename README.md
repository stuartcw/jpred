
# JPred - JPred J.League Predictions 

This documentation was autogenerated so defintely should be reviewed and corrected.

# JPred Database Management and Documentation

## Overview

This documentation covers the usage of two shell scripts: `create_db.sh` and `make_all.sh`, which facilitate the creation and management of a SQLite database for the JPred football (soccer) prediction project. The scripts are responsible for importing data from CSV files into the database and generating HTML outputs for user interaction.

## Prerequisites

Before running the scripts, ensure you have the following prerequisites installed:

- Python 3.x
- SQLite3
- sqlite-utils
- Required Python libraries (potentially listed in a `requirements.txt` file)

## Shell Scripts Overview

### 1. `create_db.sh`

This script creates a new SQLite database (`jpred.db`) by dropping any existing database, importing data, creating tables, and populating them with data from CSV files.

#### Usage

Run the script using the following command:

```bash
bash create_db.sh
```

#### Detail Steps

1. **Remove Existing Database**: Deletes the `jpred.db` file if it exists:
   ```bash
   rm jpred.db
   ```

2. **Import Data**: 
   - The script imports initial data using `import.py`:
     ```bash
     ./import.py
     ```

3. **Create Tables and Insert Data**:
   - It creates three tables, one for each league division (J1, J2, and J3) for the year 2024, and populates them with data from respective CSV files:
   ```bash
   sqlite-utils create-table jpred.db j1_2024 Wikipedia TEXT Team TEXT Position INTEGER
   sqlite-utils insert jpred.db j1_2024 JPred\ 2024\ -\ J1\ Teams.csv --csv
   ```

4. **Repeat for J2 and J3 Tables**.

### Example of Adding Teams

To manually add a team to the J1 table:

```bash
sqlite-utils insert jpred.db j1_2024 --insert --csv --values="Wikipedia Team Position" --data='{"Wikipedia":"Sample Team","Team":"Sample FC","Position":1}'
```

### 2. `make_all.sh`

This script creates the necessary directory structure for output HTML files, removes previous data, generates HTML files from the populated database, and executes the user interaction scripts.

#### Usage

Run the script with the following command:

```bash
bash make_all.sh
```

#### Steps Involved

1. **Create Necessary Directories**:
   - It creates a `docs` directory and a nested `preds` directory for output:
   ```bash
   mkdir -p docs
   mkdir -p docs/preds
   ```

2. **Remove Existing Database and Files**:
   - Deletes the `jpred.db`, any existing HTML files in `docs`, and resets the predictions directory:
   ```bash
   rm jpred.db
   rm -r docs/j*.html
   rm docs/users.html
   rm -r docs/preds/*.html
   ```

3. **Generate HTML Pages**:
   - The script executes the three commands to generate HTML files for the J1, J2, and J3 leagues:
   ```bash
   ./jpred.py docs/j1.html columns/j1.cols
   ./jpred.py docs/j2.html columns/j2.cols
   ./jpred.py docs/j3.html columns/j3.cols
   ```

4. **Generate User Interaction Page**:
   - Finally, it runs the user interaction script:
   ```bash
   ./jpred_users.py
   ```

### Example Output

After running `make_all.sh`, you can open the generated HTML files (`docs/j1.html`, `docs/j2.html`, `docs/j3.html`) in any web browser to view the team predictions for the respective leagues.

## Conclusion

The provided shell scripts facilitate automation of database setup and HTML report generation for the JPred football prediction project. The usage examples illustrate how to run the scripts and what kind of data manipulation can be performed. Adjust the CSV input files and column specifications as needed based on your dataset requirements.

Feel free to extend the functionality or modify the scripts to best suit your project needs.
### Importing CSV Data

To import data from a CSV file into an SQLite database, run the following command:

```bash
python import.py
```

#### Example

1. Prepare your CSV file (e.g., `JPred 2024 - Form responses 1.csv`) with the required data structure.
2. Ensure that the SQLite database path is set correctly in `import.py` (default: `jpred.db`).
3. Execute the script:

   ```bash
   python import.py
   ```

### Generating User Reports

You can generate HTML reports for specific users by executing the `jpred_users.py` script:

```bash
python jpred_users.py
```

This script will generate HTML files for each user based on their predictions stored in the database.

#### Example

1. Ensure your database (`jpred.db`) contains user predictions.
2. Run the command to create individual user reports:

   ```bash
   python jpred_users.py
   ```

### Generating Overall Leaderboard

To generate an overall leaderboard, use the `jpred.py` script:

```bash
python jpred.py <output_html_filename> <columns_file>
```

- `<output_html_filename>`: Name of the output HTML file (e.g., `leaderboard.html`).
- `<columns_file>`: A text file containing column names you want to analyze, one per line.

#### Example

1. Create a text file called `columns.txt` with the following content:

   ```plaintext
   Name
   Team
   Prediction
   ```

2. Generate the leaderboard using the command:

   ```bash
   python jpred.py users.html columns.txt
   ```

This will create an HTML file named `users.html` containing the leaderboard with user predictions.

## File Structure

```plaintext
jpred/
├── import.py              # Script to import CSV data into SQLite
├── jpred.py               # Script to generate reports based on the database
├── jpred_users.py         # Script to generate individual user reports
├── templates/             # Directory containing Jinja template files
│   ├── template.html      # Base template for user reports
│   └── user_template.html  # Template for individual user reports
├── JPred 2024 - Form responses 1.csv  # Example CSV input file
├── columns.txt            # Example file containing columns to analyze
└── jpred.db              # SQLite database containing predictions
```

## Function Descriptions

### import.py
- **csv_to_sqlite(csv_file_path, sqlite_db_path, table_name)**: Reads a CSV file and inserts its data into an SQLite database.

### jpred.py
- **create_connection(db_file)**: Establishes a connection to the SQLite database.
- **query_database(conn, column)**: Executes a query on the SQLite database and returns the results.
- **main(html_filename, columns_file)**: CLI entry point for generating a leaderboard based on specified columns.

### jpred_users.py
- **create_connection(db_file)**: Establishes a connection to the SQLite database.
- **get_all_users(conn)**: Retrieves all users from the database.
- **write_one_user(conn, name, html_filename, env)**: Generates an HTML file for a specific user's predictions.
- **make_league_score_SQL(name, league, year)**: Constructs an SQL query to calculate user scores for given predictions.

## License

This project is open-source and available under the MIT License. Feel free to contribute!# jpred
